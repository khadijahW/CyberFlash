name: Deploy Website

on:
    push:
        branches: [ main ]
        paths:
        - 'frontend/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4  # Updated to the latest version

    - name: Login to Azure
      id: azure_login
      uses: azure/login@v1
      with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Verify Login
      run: |
        echo "Azure account show:"
        az account show

    - name: List Storage Accounts (Debug)
      run: |
        echo "Listing storage accounts for debugging:"
        az storage account list

    - name: Upload to blob storage
      uses: azure/CLI@v1
      with:
        inlineScript: |
          echo "Uploading to blob storage"
          az storage blob upload-batch --account-name getresumecounter12 -d '$web' -s frontend/
          echo "List blobs in the storage container"
          az storage blob list --account-name getresumecounter12 --container-name '$web'

    - name: Purge CDN endpoint
      uses: azure/CLI@v1
      with:
        inlineScript: |
          echo "Purging CDN endpoint"
          az cdn endpoint purge --content-paths "/*" --profile-name "CyberFlash" --name "CyberFlash" --resource-group "azureresume-rg"

    - name: Logout of Azure
      if: always()
      run: |
        echo "Logging out of Azure"
        az logout
