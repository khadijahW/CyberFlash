name: "Azure_Frontend_Git_Actions"
on:
    push:
        branches:
            - main
        paths:
            - 'frontend/**'
jobs:
    auth:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - uses: azure/login@v1
              with:
                creds: ${{secrets.AZURE_CREDENTIALS}}

            - name: Upload to blob storage
              uses: azure/CLI@v1
              with:
                inlineScript: |
                    az storage blob upload-batch --account-name getresumecounter12 --account-key ${{ secrets.AZURE_STORAGE_KEY }} --auth-mode key --overwrite -d '$web' -s frontend

            - name: Purge CDN endpoint
              uses: azure/CLI@v1
              with:
                inlineScript: |
                     az cdn endpoint purge --content-paths  "/*" --profile-name "CyberFlash" --name "CyberFlash" --resource-group "azureresume-rg"

            - name: az Logout
              run: |
                  az logout
              if: always()